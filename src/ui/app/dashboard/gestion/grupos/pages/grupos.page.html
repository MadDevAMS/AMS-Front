<div class="flex flex-col md:flex-row md:h-full gap-3">
  <div class="flex flex-col xl:flex-row gap-3 flex-1">
    <div class="flex-1 h-0 xl:h-full">
      <tabla-grupos [grupos]="service.grupos"></tabla-grupos>
    </div>
    <div class="flex-1 h-0 xl:h-full">
      <tabla-usuarios [usuarios]="service.usuarios"></tabla-usuarios>
    </div>
  </div>
  <div class="flex flex-col md:w-1/2 xl:w-1/3 gap-3 overflow-auto">
    <card-layout [formGroup]="serviceForm.formGrupo" title="Datos de grupo">
      <div class="flex flex-col gap-3" body>
        <mat-form-field
          appearance="outline"
          class="h-full sm:!flex-1"
        >
          <mat-label>Nombre</mat-label>
          <mat-icon matPrefix>people</mat-icon>
          <input type="text" formControlName="nombre" name="nombre" matInput />
          @if(serviceForm.hasError('nombre', 'required')) {
          <mat-error>Ingrese el nombre del grupo</mat-error> }
        </mat-form-field>
        <mat-form-field
          appearance="outline"
          class="h-full sm:!flex-1"
        >
          <mat-label>Descripcion</mat-label>
          <textarea
            formControlName="descripcion"
            name="descripcion"
            matInput
          ></textarea>
        </mat-form-field>
      </div>
    </card-layout>
    <card-layout class="md:flex-1" title="Permisos y accesos">
      <div class="flex flex-col gap-2" body>
        @for(permiso of service.permisos; track permiso.nombre) {
          <div class="flex items-center gap-1">
            <mat-checkbox [checked]="serviceForm.isChecked(permiso)" (change)="serviceForm.onCheckboxChange($event, permiso)" color="primary"></mat-checkbox>
            <mat-expansion-panel
              class="!rounded !bg-smoke1 !shadow-sm-ams-01 !w-full"
              hideToggle
            >
              <mat-expansion-panel-header class="!ps-0">
                <div 
                  class="py-2 ps-4 pe-2 flex text-sm w-full gap-4 border-s-4 border-s-green text-ellipsis overflow-clip text-nowrap"
                >
                  <p>{{ permiso.nombre }}</p>
                </div>
              </mat-expansion-panel-header>
              <p class="text-wrap w-full">{{ permiso.descripcion }}</p>
            </mat-expansion-panel>
          </div>
        }
      </div>
    </card-layout>
    <div class="w-full flex flex-col xl:flex-row gap-2">
      <button
        (click)="serviceForm.submit()"
        color="primary"
        class="!rounded disabled:!bg-blue01 disabled:!bg-opacity-80 !py-4 !font-semibold !text-xs xl:w-1/2" 
        mat-raised-button
      >      
        @if(serviceForm.grupoSeleccionado) {
          Actualizar grupo
        } 
        @if(!serviceForm.grupoSeleccionado) {
          <mat-icon>add</mat-icon>
        }
        @if(!serviceForm.grupoSeleccionado) {
          Generar grupo
        }
      </button>
      <button
        (click)="serviceForm.limpiar()"
        class="!rounded !py-4 !font-semibold !text-xs xl:w-1/2" 
        mat-raised-button
      >
        @if(serviceForm.grupoSeleccionado) {
          Cancelar
        } @else {
          Limpiar
        }
      </button>
    </div>
  </div>
</div>
